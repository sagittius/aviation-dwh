# Аналитический отчёт: авиаперевозки США

## Цель проекта

Построить аналитическую систему для ответа на вопрос:  
**какие факторы приводят к отменам и задержкам рейсов — и как погодные условия влияют на них?**

Бизнес-контекст: неправильное планирование загрузки ведёт к потерям от нехватки ресурсов или их избытка.  
Эта система позволяет принимать решения на основе данных.

---

## Данные

| Параметр | Значение |
|---|---|
| Источники | BTS (рейсы США) + METAR-архив (погода) |
| Аэропорты | AVL (Asheville NC), FAY (Fayetteville NC), BIS (Bismarck ND), GFK (Grand Forks ND) |
| Погодные параметры | Температура, давление, скорость ветра, облачность, видимость, тип осадков |
| Период | Исторические данные, включая 2024 год |
| Гранулярность | Отдельные записи рейсов, джойн с почасовыми метеонаблюдениями |

---

## Ключевые выводы

### 1. Погода — главная причина отмен

По всем 4 аэропортам погода (код отмены `B`) составляет **67–79% всех отмен**.

| Код | Причина | Доля |
|---|---|---|
| B | Погода | **67–79%** |
| A | Авиакомпания / перевозчик | 16–36% |
| C | Национальная авиационная система | 5–21% |
| D | Безопасность | <1% |

**Вывод:** снижение погодных рисков даёт наибольший потенциал для сокращения отмен.

---

### 2. Отмены подчиняются сезонному паттерну

Пики отмен приходятся на **зиму и лето**:
- Зима (январь): максимальное количество отмен, особенно в AVL
- Лето: второй по величине пик по всем аэропортам

**Вывод:** сезонное планирование ресурсов и резервов должно концентрироваться на этих двух периодах.

---

### 3. Задержки короткие, но с длинным хвостом

Для выполненных рейсов:
- Большинство задержек — в диапазоне **0–10 минут**
- Пик распределения: **5–7 минут**
- Хвост: до **150 минут** в редких случаях

**Вывод:** большинство операций проходит близко к расписанию, но выбросы требуют отдельного разбора.

---

### 4. Холод + осадки = выше риск отмены

Корреляционный анализ на примере аэропорта BIS:

| Условие | Средняя температура |
|---|---|
| Со снегом | **−7°C** |
| Без снега | **+4°C** |

Более холодные периоды с осадками стабильно коррелируют с ростом вероятности отмен.  
Витрина `cancellation_report` связывает каждую отмену с точными метеоусловиями в момент вылета.

---

### 5. Маршрутные сети концентрируются на хабах

- Топ-направления из AVL: LGA, ORD, SFB, DFW
- BIS, GFK, FAY: аналогичная схема «хаб и спицы»
- Самые дальние рейсы: ~1 800 миль (на запад, до Лос-Анджелеса)

**Вывод:** сбои в хабовых аэропортах каскадно влияют на региональные — AVL и FAY.

---

## Дашборд (Yandex DataLens)

7 чартов на основе слоёв DM и DDS.

### Чарт 1 — Карта аэропортов
Географическое расположение аэропортов. Размер точки = количество рейсов. Тултип показывает долю отмен и среднюю высоту полёта.  
**Применение:** быстро оценить загруженность аэропортов и их подверженность отменам.

### Чарт 2 — Дальность рейсов по направлениям
Горизонтальная диаграмма: средняя дистанция из каждого аэропорта до каждого города назначения.  
**Применение:** выбрать оптимальный аэропорт вылета для нужного маршрута; длинные рейсы видны сразу.

### Чарт 3 — Отменённые рейсы по месяцам
Столбчатая диаграмма: суммарные отмены по месяцам, цвет — аэропорт.  
**Применение:** визуализация сезонных паттернов; январь 2024 — максимум отмен, доминирует AVL.

### Чарт 4 — Причины отмен по аэропортам
Нормированная стопка (100%): распределение кодов отмен по аэропортам.  
**Применение:** сравнить профили рисков аэропортов — погода доминирует везде, но в разной доле.

### Чарт 5 — Распределение рейсов (tree-map)
Площадь блоков пропорциональна количеству рейсов по направлениям из каждого аэропорта.  
**Применение:** одновременно сравнивать аэропорты и топ-направления; концентрация на хабах хорошо видна.

### Чарт 6 — Гистограммы задержек вылета
Распределение `dep_delay_min` для выполненных рейсов по каждому аэропорту.  
**Применение:** сравнить профили задержек аэропортов; выявить структурно худший по производительности.

### Чарт 7 — Таблица: температура и снег
Сводная таблица: минимум / максимум / среднее температуры по аэропорту и флагу снега (`snow_flg`).  
**Применение:** операционное планирование зимних условий; техническая подготовка наземных служб.

---

## Модель данных для анализа

Ключевые джойны, используемые в отчётах:

```sql
-- Рейс ↔ Погода: совпадение по аэропорту + усечению часа
dds.flights f
LEFT JOIN dds.weather w
    ON  airport_rk = w.airport_rk
    AND DATE_TRUNC('hour', dep_timestamp) = DATE_TRUNC('hour', w.local_time)

-- Расшифровка кода отмены
CASE cancellation_code
    WHEN 'A' THEN 'Airline/Carrier'
    WHEN 'B' THEN 'Weather'
    WHEN 'C' THEN 'National Air System'
    WHEN 'D' THEN 'Security'
END
```

---

## Итоги

| Направление | Вывод |
|---|---|
| Главная причина отмен | Погода (67–79% по всем аэропортам) |
| Сезонный риск | Январь и летние месяцы |
| Типичная задержка | 5–7 мин; хвост до 150 мин |
| Погодный порог | Снег + температура ниже −7°C существенно увеличивает риск в BIS |
| Концентрация маршрутов | Схема «хаб и спицы»; сбои распространяются от хабов |

**Система позволяет:**
- Заблаговременно корректировать расписание перед погодными событиями
- Строить профили рисков аэропортов для операций перевозчиков
- Распределять ресурсы на основе данных в пиковые сезоны отмен
